<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MoodBuy â€“ Your Mood, Your Life (Modified)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gradient-to-br from-purple-600 via-indigo-700 to-purple-800 text-white min-h-screen">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback } = React;

    // --- DATA ---
    const data = {
      concerts: [
        { id: 'c1', type: 'concert', artist: "Hatsune Miku", event: "MIKU EXPO 2025", venue: "SM Mall of Asia Arena, Pasay", date: "Nov 16, 2025", price: 3500 },
        { id: 'c2', type: 'concert', artist: "David Archuleta / Vanessa Carlton / Blue", event: "Playback Pop It Up!", venue: "SM Mall of Asia Arena", date: "Nov 21, 2025", price: 2500 },
        { id: 'c3', type: 'concert', artist: "Dionela", event: "The Grace Tour", venue: "New Frontier Theater", date: "Nov 21â€“22, 2025", price: 1500 },
        { id: 'c4', type: 'concert', artist: "Jason Derulo", event: "Live in Manila", venue: "SM Mall of Asia Arena", date: "Nov 22, 2025", price: 3000 },
        { id: 'c5', type: 'concert', artist: "BLACKPINK", event: "DEADLINE World Tour", venue: "Philippine Arena, Bulacan", date: "Nov 22â€“23, 2025", price: 5000 },
      ],
      food: [
        { id: 'f1', type: 'food', name: "Jollibee Chickenjoy", price: 120 }, 
        { id: 'f2', type: 'food', name: "Mang Inasal Paa", price: 150 }, 
        { id: 'f3', type: 'food', name: "Chowking Lauriat", price: 250 },
        { id: 'f4', type: 'food', name: "Greenwich Pizza", price: 400 },
      ],
      perfume: [
        { id: 'p1', type: 'perfume', name: "Bench Body Cologne", price: 180 }, 
        { id: 'p2', type: 'perfume', name: "Victoria's Secret Bombshell", price: 3500 },
      ],
      pants: [
        { id: 'p3', type: 'pants', name: "Levi's 501", price: 2800 }, 
        { id: 'p4', type: 'pants', name: "Uniqlo Jeans", price: 1500 },
      ],
      shirts: [
        { id: 's1', type: 'shirt', name: "Uniqlo U Shirt", price: 790 }, 
        { id: 's2', type: 'shirt', name: "H&M Shirt", price: 650 },
      ],
      accessories: [
        { id: 'a1', type: 'accessory', name: "Casio G-Shock Watch", price: 4500 }, 
        { id: 'a2', type: 'accessory', name: "Rayâ€‘Ban Sunglasses", price: 7000 },
      ],
      travel: [
        { id: 't1', type: 'travel', name: "Boracay, Aklan (3D/2N)", price: 10000 }, 
        { id: 't2', type: 'travel', name: "El Nido, Palawan Package", price: 15000 },
      ]
    };

    // Helper to get all items in a flat array for easier lookup
    const allItems = [
        ...data.concerts, 
        ...data.food.map(f => ({...f, price: f.price})), // Food items simplified for demo
        ...data.perfume, ...data.pants, ...data.shirts, ...data.accessories, ...data.travel
    ];

    const TABS = [
      { id: "concerts", label: "Concerts", icon: "ðŸŽµ" },
      { id: "food", label: "Food", icon: "ðŸ”" },
      { id: "perfume", label: "Perfume", icon: "ðŸ’" },
      { id: "pants", label: "Pants", icon: "ðŸ‘–" },
      { id: "shirts", label: "Shirts", icon: "ðŸ‘•" },
      { id: "accessories", label: "Accessories", icon: "âŒš" },
      { id: "travel", label: "Travel", icon: "âœˆï¸" }
    ];
    
    // --- COMPONENTS ---

    // 1. AI Assistant Component
    const AIAssistant = ({ tab, cartItems }) => {
      const [chatOpen, setChatOpen] = useState(false);
      const [message, setMessage] = useState('');
      const [history, setHistory] = useState([
        { sender: 'AI', text: "Hello! I'm MoodBot, your Sales Psychologist. How are you feeling today, and what kind of product are you looking for?" }
      ]);

      const cartCount = cartItems.length;

      const mockAIResponse = (userMsg) => {
        const lowerMsg = userMsg.toLowerCase();
        let response = "That's interesting! Based on your current mood and the items in our **" + tab + "** category, I recommend you look at our featured items. Can I help you find something specific?";
        
        if (cartCount > 0) {
            response += ` P.S. I see **${cartCount}** item(s) in your cart. Ready to check out and treat yourself?`;
        }

        if (lowerMsg.includes("sad") || lowerMsg.includes("lonely")) {
            response = "It sounds like you might need a pick-me-up! In the spirit of self-care, maybe a ticket to the **Hatsune Miku** concert or a soothing **Victoria's Secret Bombshell** perfume could elevate your spirits.";
        } else if (lowerMsg.includes("happy") || lowerMsg.includes("excited")) {
            response = "That's fantastic! Harness that energy! A celebratory meal at **Jollibee** or planning a grand trip to **Boracay** would be a great way to mark this moment.";
        }
        
        return response;
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!message.trim()) return;

        const newUserMsg = { sender: 'User', text: message };
        setHistory(prev => [...prev, newUserMsg]);
        setMessage('');

        // Mock AI response delay
        setTimeout(() => {
          const aiResponse = mockAIResponse(newUserMsg.text);
          setHistory(prev => [...prev, { sender: 'AI', text: aiResponse }]);
        }, 800);
      };

      return (
        <div className="fixed bottom-5 right-5 z-50">
          {!chatOpen && (
            <button 
              onClick={() => setChatOpen(true)}
              className="bg-yellow-500 hover:bg-yellow-600 text-black p-4 rounded-full shadow-2xl transition transform hover:scale-110"
              title="Open AI Chat"
            >
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4m-7 0L7 9.586m0 0A2 2 0 015 8h2m2-3h4M7 3h10a2 2 0 012 2v4m0 0l-3 3"></path></svg>
            </button>
          )}
          {chatOpen && (
            <div className="bg-white bg-opacity-95 backdrop-blur-md rounded-xl shadow-2xl w-80 h-96 flex flex-col">
              <div className="flex justify-between items-center p-3 bg-yellow-400 text-black rounded-t-xl">
                <h3 className="font-bold">ðŸ¤– MoodBot (Sales Psychologist)</h3>
                <button onClick={() => setChatOpen(false)} className="text-xl font-bold">Ã—</button>
              </div>
              <div className="flex-1 overflow-y-auto p-3 space-y-3">
                {history.map((msg, index) => (
                  <div key={index} className={`flex ${msg.sender === 'User' ? 'justify-end' : 'justify-start'}`}>
                    <div className={`max-w-xs p-2 rounded-lg text-sm ${
                      msg.sender === 'User' ? 'bg-indigo-500 text-white' : 'bg-gray-200 text-black'
                    }`}>
                      {msg.text}
                    </div>
                  </div>
                ))}
              </div>
              <form onSubmit={handleSubmit} className="p-3 border-t border-gray-300">
                <input
                  type="text"
                  value={message}
                  onChange={(e) => setMessage(e.target.value)}
                  placeholder="Ask MoodBot..."
                  className="w-full px-3 py-2 rounded-lg text-black bg-white focus:outline-none focus:ring-1 focus:ring-yellow-400"
                />
              </form>
            </div>
          )}
        </div>
      );
    };

    // 2. Cart View Component
    const CartView = ({ cartItems, onRemove, onCheckout, onContinueShopping }) => {
        const total = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        if (cartItems.length === 0) {
            return (
                <div className="text-center p-12 bg-white bg-opacity-10 rounded-xl max-w-lg mx-auto mt-12">
                    <h2 className="text-3xl font-bold mb-4">ðŸ›’ Your Cart is Empty</h2>
                    <p className="text-gray-300">Time to find something that matches your mood!</p>
                    <button onClick={onContinueShopping} className="mt-6 px-6 py-2 bg-yellow-500 hover:bg-yellow-600 text-black font-semibold rounded-lg transition">
                        Continue Shopping
                    </button>
                </div>
            );
        }

        return (
            <div className="p-4 md:p-8">
                <h2 className="text-4xl font-bold mb-8">ðŸ›’ Shopping Cart</h2>
                <div className="grid md:grid-cols-3 gap-8">
                    <div className="md:col-span-2 space-y-4">
                        {cartItems.map(item => (
                            <div key={item.id} className="flex justify-between items-center bg-white bg-opacity-10 p-4 rounded-lg">
                                <div className="flex items-center space-x-4">
                                    <div className="w-16 h-16 bg-gray-500 rounded-lg flex items-center justify-center text-xs text-white">
                                        [Image]
                                    </div>
                                    <div>
                                        <p className="font-semibold text-lg">{item.name || item.artist}</p>
                                        <p className="text-sm text-gray-300">Quantity: {item.quantity}</p>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <p className="font-bold text-yellow-300">â‚±{(item.price * item.quantity).toLocaleString()}</p>
                                    <button 
                                        onClick={() => onRemove(item.id)} 
                                        className="text-red-400 text-sm hover:text-red-500 mt-1"
                                    >
                                        Remove
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                    
                    {/* Checkout Summary */}
                    <div className="md:col-span-1 bg-white bg-opacity-15 p-6 rounded-xl shadow-lg h-fit">
                        <h3 className="text-2xl font-bold mb-4">Summary</h3>
                        <div className="flex justify-between border-b border-gray-600 pb-2 mb-2">
                            <span>Subtotal:</span>
                            <span>â‚±{total.toLocaleString()}</span>
                        </div>
                        <div className="flex justify-between font-bold text-xl mb-6">
                            <span>Total:</span>
                            <span className="text-yellow-300">â‚±{total.toLocaleString()}</span>
                        </div>
                        <button 
                            onClick={onCheckout} 
                            className="w-full py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition transform hover:scale-[1.02]"
                        >
                            Proceed to Checkout
                        </button>
                        <button onClick={onContinueShopping} className="w-full mt-3 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition">
                            Continue Shopping
                        </button>
                    </div>
                </div>
            </div>
        );
    };

    // 3. Item Card Component
    const ItemCard = ({ item, tab, onAddToCart }) => {
        // Use name if available, otherwise fallback to artist
        const itemName = item.name || item.artist;
        const displayPrice = typeof item.price === 'number' ? `â‚±${item.price.toLocaleString()}` : item.price;
        
        // Google Images Placeholder Logic: replaces picsum with a search-friendly query
        const imageQuery = itemName + (item.event ? ' ' + item.event : '');
        const imageUrl = `https://via.placeholder.com/400x250/374151/FFFFFF?text=Search+Image+for+${encodeURIComponent(imageQuery)}`;

        return (
            <div 
                className="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl overflow-hidden hover:bg-opacity-20 transition transform hover:scale-105 hover:shadow-2xl"
            >
                <img
                    src={imageUrl} // Placeholder for Google Images search result
                    alt={itemName}
                    className="w-full h-48 object-cover"
                    loading="lazy"
                />
                
                <div className="p-4">
                    {tab === "concerts" ? (
                        <>
                            <h2 className="text-xl font-bold mb-1">{item.artist}</h2>
                            <p className="text-yellow-300 font-medium text-sm mb-2">{item.event}</p>
                            <p className="text-gray-200 text-sm mb-1">{item.venue}</p>
                            <p className="text-gray-300 text-sm mb-2">{item.date}</p>
                            <p className="text-green-300 font-semibold text-sm">{displayPrice}</p>
                        </>
                    ) : (
                        <>
                            <p className="text-lg font-medium text-center">{itemName}</p>
                            <p className="text-green-300 font-semibold text-center mt-1">{displayPrice}</p>
                        </>
                    )}
                    <button
                        onClick={() => onAddToCart(item)}
                        className="mt-3 w-full py-2 bg-yellow-500 hover:bg-yellow-600 text-black font-bold rounded-lg transition text-sm"
                    >
                        Add to Cart ðŸ›’
                    </button>
                </div>
            </div>
        );
    };


    // --- MAIN APP ---
    const App = () => {
      const [apiKey, setApiKey] = useState("");
      const [loggedIn, setLoggedIn] = useState(false);
      const [tab, setTab] = useState("concerts");
      const [searchQuery, setSearchQuery] = useState("");
      const [cartItems, setCartItems] = useState([]);
      const [view, setView] = useState("shop"); // 'shop' or 'cart'
      const [streak, setStreak] = useState(0); // 4. Streak Points

      // --- ITEM FILTERING LOGIC ---
      const items = useMemo(() => {
        if (!loggedIn) return [];
        
        let rawItems;
        switch(tab) {
          case "concerts": rawItems = data.concerts; break;
          case "food": rawItems = data.food; break;
          case "perfume": rawItems = data.fashion.perfume ? data.fashion.perfume.map((name, i) => ({ id: `p${i+10}`, type: 'perfume', name, price: 500 })) : []; break;
          case "pants": rawItems = data.fashion.pants ? data.fashion.pants.map((name, i) => ({ id: `p${i+20}`, type: 'pants', name, price: 2000 })) : []; break;
          case "shirts": rawItems = data.fashion.shirts ? data.fashion.shirts.map((name, i) => ({ id: `p${i+30}`, type: 'shirt', name, price: 800 })) : []; break;
          case "accessories": rawItems = data.fashion.accessories ? data.fashion.accessories.map((name, i) => ({ id: `p${i+40}`, type: 'accessory', name, price: 3000 })) : []; break;
          case "travel": rawItems = data.travel; break;
          default: rawItems = [];
        }

        if (!searchQuery.trim()) return rawItems;

        const query = searchQuery.toLowerCase();
        return rawItems.filter(item => {
          return (item.artist?.toLowerCase().includes(query) || 
                 item.event?.toLowerCase().includes(query) ||
                 item.venue?.toLowerCase().includes(query) ||
                 item.name?.toLowerCase().includes(query));
        });
      }, [tab, loggedIn, searchQuery]);

      // --- CART HANDLERS ---
      const handleAddToCart = useCallback((itemToAdd) => {
        setCartItems(prevCart => {
          const existingItem = prevCart.find(item => item.id === itemToAdd.id);
          if (existingItem) {
            return prevCart.map(item =>
              item.id === itemToAdd.id
                ? { ...item, quantity: item.quantity + 1 }
                : item
            );
          } else {
            return [...prevCart, { ...itemToAdd, quantity: 1, name: itemToAdd.name || itemToAdd.artist }];
          }
        });
      }, []);

      const handleRemoveFromCart = useCallback((itemId) => {
        setCartItems(prevCart => prevCart.filter(item => item.id !== itemId));
      }, []);

      const handleCheckout = () => {
        alert(`Checkout successful! Total: â‚±${cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0).toLocaleString()}. You earned 1 streak point!`);
        setCartItems([]);
        setStreak(prev => prev + 1); // Increment streak on successful checkout
        setView("shop");
      };

      // --- AUTH HANDLERS ---
      const handleLogin = () => {
        if (apiKey.trim()) {
          setLoggedIn(true);
          // Mock daily streak logic upon login
          setStreak(prev => prev + 1); 
        } else {
          alert("Please enter a valid API key.");
        }
      };

      const handleLogout = () => {
        setLoggedIn(false);
        setApiKey("");
        setSearchQuery("");
        setCartItems([]);
        setStreak(0);
        setView("shop");
      };

      if (!loggedIn) {
        // Login View (unchanged)
        return (
          <div className="flex flex-col items-center justify-center min-h-screen p-4">
            <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-8 shadow-2xl max-w-md w-full">
              <div className="text-center mb-8">
                <h1 className="text-5xl font-bold mb-2 bg-gradient-to-r from-yellow-300 to-pink-300 bg-clip-text text-transparent">
                  MoodBuy
                </h1>
                <p className="text-gray-200 text-lg">Your Mood, Your Life</p>
              </div>
              
              <input
                type="password"
                placeholder="Enter API Key"
                value={apiKey}
                onChange={e => setApiKey(e.target.value)}
                onKeyPress={e => e.key === 'Enter' && handleLogin()}
                className="w-full px-4 py-3 rounded-lg text-black bg-white bg-opacity-90 mb-4 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"
              />
              
              <button
                onClick={handleLogin}
                className="w-full px-6 py-3 bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 rounded-lg font-bold text-black transition transform hover:scale-105 shadow-lg"
              >
                Start Exploring
              </button>
            </div>
          </div>
        );
      }

      if (view === "cart") {
        return (
          <CartView 
            cartItems={cartItems} 
            onRemove={handleRemoveFromCart}
            onCheckout={handleCheckout}
            onContinueShopping={() => setView("shop")}
          />
        );
      }

      // Main Shop View
      return (
        <div className="min-h-screen p-4 md:p-8">
          <div className="max-w-7xl mx-auto">
            {/* Header */}
            <div className="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
              <div>
                <h1 className="text-4xl md:text-5xl font-bold bg-gradient-to-r from-yellow-300 to-pink-300 bg-clip-text text-transparent">
                  MoodBuy
                </h1>
                <p className="text-gray-200 mt-1">Discover what matches your mood</p>
              </div>
              
              <div className="flex items-center space-x-4">
                {/* Streak Points Display */}
                <div className="px-4 py-2 bg-pink-500 rounded-lg text-sm font-medium shadow-lg">
                    ðŸ”¥ Streak: **{streak}**
                </div>
                
                {/* Cart Button */}
                <button
                    onClick={() => setView("cart")}
                    className="relative px-4 py-2 bg-green-500 hover:bg-green-600 rounded-lg transition text-sm font-medium"
                >
                    ðŸ›’ Cart
                    {cartItems.length > 0 && (
                        <span className="absolute -top-2 -right-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">
                            {cartItems.length}
                        </span>
                    )}
                </button>
                
                <button
                  onClick={handleLogout}
                  className="px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg transition text-sm font-medium"
                >
                  Logout
                </button>
              </div>
            </div>

            {/* Search Bar */}
            <div className="mb-6">
              <input
                type="text"
                placeholder="Search..."
                value={searchQuery}
                onChange={e => setSearchQuery(e.target.value)}
                className="w-full md:w-96 px-4 py-3 rounded-lg text-black bg-white bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"
              />
            </div>

            {/* Tabs */}
            <div className="flex flex-wrap gap-2 mb-8">
              {TABS.map(t => (
                <button
                  key={t.id}
                  onClick={() => {
                    setTab(t.id);
                    setSearchQuery("");
                  }}
                  className={`px-4 py-2 rounded-lg font-medium transition transform hover:scale-105 ${
                    tab === t.id 
                      ? "bg-gradient-to-r from-yellow-400 to-yellow-500 text-black shadow-lg" 
                      : "bg-white bg-opacity-20 hover:bg-opacity-30"
                  }`}
                >
                  <span className="mr-2">{t.icon}</span>
                  {t.label}
                </button>
              ))}
            </div>

            {/* Content Grid */}
            {items.length === 0 ? (
              <div className="text-center py-12">
                <p className="text-xl text-gray-300">No results found</p>
              </div>
            ) : (
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {items.map((item) => (
                  <ItemCard 
                    key={item.id} 
                    item={item} 
                    tab={tab}
                    onAddToCart={handleAddToCart}
                  />
                ))}
              </div>
            )}
          </div>
          
          {/* 1. AI Assistant Component */}
          <AIAssistant tab={tab} cartItems={cartItems} />
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>